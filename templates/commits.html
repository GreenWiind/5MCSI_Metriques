<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Commits minute par minute</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
  </head>

  <body>
    <h2>Nombre de commits (minute par minute)</h2>

    <div id="chart_div" style="width: 900px; height: 500px;"></div>

    <script>
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(loadData);

      function loadData() {
        fetch("/commits-data/")
          .then((response) => response.json())
          .then((data) => drawChart(data.results))
          .catch((err) => {
            console.error(err);
            document.getElementById("chart_div").innerText =
              "Erreur : impossible de charger les donnÃ©es.";
          });
      }

      function drawChart(rows) {
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn("string", "Minute");
        dataTable.addColumn("number", "Commits");

        rows.forEach((r) => {
          dataTable.addRow([r.minute, Number(r.count)]);
        });

        const options = {
          title: "Commits (minute par minute)",
          legend: { position: "none" },
          hAxis: { title: "Minute", slantedText: true, slantedTextAngle: 45 },
          vAxis: { title: "Nombre de commits" },
        };

        const chart = new google.visualization.ColumnChart(
          document.getElementById("chart_div")
        );
        chart.draw(dataTable, options);
      }
    </script>
  </body>
</html>
